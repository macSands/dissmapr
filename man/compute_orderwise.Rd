% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_orderwise.R
\name{compute_orderwise}
\alias{compute_orderwise}
\title{Compute order‐wise ecological indices across multiple sites}
\usage{
compute_orderwise(
  df,
  func,
  site_col,
  sp_cols,
  order = 2,
  sample_no = NULL,
  sample_portion = 1,
  parallel = TRUE,
  n_workers = parallel::detectCores() - 1,
  coord_cols = NULL
)
}
\arguments{
\item{df}{A \code{data.frame} or \code{data.table} containing site identifiers,
species abundances, and optionally spatial coordinates.}

\item{func}{A function that computes the index for a single‐site (when
\code{order = 1}) or between‐site vectors (\code{order >= 2}). Must accept one
vector (for \code{order = 1}) or two vectors (for \code{order >= 2}), with an
optional \code{coord_cols} argument when using geographic distance.}

\item{site_col}{A string naming the column in \code{df} that contains site IDs.}

\item{sp_cols}{A character vector of column names in \code{df} representing
species counts or presence–absence data; ignored if \code{func} is
\code{geodist_helper}.}

\item{order}{Integer scalar (or vector) of the combination order(s) to
compute (e.g. \code{1} for single sites, \code{2} for pairs, \code{3} for triplets).
Default is \code{2}.}

\item{sample_no}{Optional integer: maximum number of combinations to
sample for higher orders (\code{order >= 3}). If \code{NULL} (default), all
combinations are used (subject to \code{sample_portion}).}

\item{sample_portion}{Numeric in (0, 1], proportion of all possible
combinations to sample when \code{order >= 3}. Defaults to \code{1} (100\%).}

\item{parallel}{Logical; whether to use parallel processing via
the \strong{future} framework. Default is \code{TRUE}.}

\item{n_workers}{Integer; number of parallel workers
(defaults to \code{parallel::detectCores() - 1}).}

\item{coord_cols}{Optional character vector of column names for spatial
coordinates (e.g. \code{c("x", "y")}). Required when \code{func} is
\code{geodist_helper}.}
}
\value{
A \code{data.table} with columns:
\itemize{
\item \code{site_from}: origin site ID
\item \code{site_to}: target site ID(s) (or \code{NA} for single‐site)
\item \code{value}: computed index value
\item \code{order}: combination order used
}
}
\description{
This function computes ecological index values (e.g. dissimilarity metrics,
distances, turnover) for sets of sites at specified orders (single‐sites,
pairs, higher‐order combinations). It supports both specialized
vectorized implementations (for Gower dissimilarity) and generic or
parallel looped approaches.
}
\details{
\itemize{
\item \strong{Order 1} returns single‐site values (calls \code{func(vec)} once per site).
\item \strong{Order 2} uses a fast path for \code{orderwise_diss_gower}, a pairwise loop
for \code{geodist_helper}, or a generic loop for other functions.
\item \strong{Higher orders} (\verb{≥ 3}) sample or exhaustively generate site‐sets,
then compute values (optionally in parallel).
}
}
\examples{
# Single‐site sum of abundances
df <- data.frame(site = rep(letters[1:3], each = 5),
                 sp1  = sample(0:5, 15, TRUE))
compute_orderwise(df,
                  func     = function(x) sum(x),
                  site_col = "site",
                  sp_cols  = "sp1",
                  order    = 1)

# Pairwise Gower dissimilarity (vectorized path)
compute_orderwise(df,
                  func     = orderwise_diss_gower,
                  site_col = "site",
                  sp_cols  = "sp1",
                  order    = 2)

}
