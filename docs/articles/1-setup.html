<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1-setup • dissmapr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="1-setup">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dissmapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-setup.html">1-setup</a></li>
    <li><a class="dropdown-item" href="../articles/2-grid.html">2-grid</a></li>
    <li><a class="dropdown-item" href="../articles/3-enviro.html">3-enviro</a></li>
    <li><a class="dropdown-item" href="../articles/4-zeta.html">4-zeta</a></li>
    <li><a class="dropdown-item" href="../articles/5-bioregion.html">5-bioregion</a></li>
    <li><a class="dropdown-item" href="../articles/7-examples.html">7-examples</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/macSands/dissmapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>1-setup</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/macSands/dissmapr/blob/HEAD/vignettes/1-setup.Rmd" class="external-link"><code>vignettes/1-setup.Rmd</code></a></small>
      <div class="d-none name"><code>1-setup.Rmd</code></div>
    </div>

    
    
<hr>
<div class="section level2">
<h2 id="dissmapr">
<code>dissmapr</code><a class="anchor" aria-label="anchor" href="#dissmapr"></a>
</h2>
<div class="section level3">
<h3 id="a-novel-framework-for-automated-compositional-dissimilarity-and-biodiversity-turnover-analysis">A Novel Framework for Automated Compositional Dissimilarity and
Biodiversity Turnover Analysis<a class="anchor" aria-label="anchor" href="#a-novel-framework-for-automated-compositional-dissimilarity-and-biodiversity-turnover-analysis"></a>
</h3>
<hr>
</div>
<div class="section level3">
<h3 id="step-by-step-workflow">Step-by-Step Workflow<a class="anchor" aria-label="anchor" href="#step-by-step-workflow"></a>
</h3>
<p>This section provides a concise, reproducible “from-scratch” pathway
for setting up <strong><code>dissmapr</code></strong>. By the end of
these steps you will have:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Installed and loaded</strong> the latest development version
of <code>dissmapr</code> from GitHub.<br>
</li>
<li>
<strong>Loaded all supporting packages</strong> needed for spatial
manipulation, biodiversity modelling, and visualisation.<br>
</li>
<li>
<strong>Downloaded exemplar occurrence data</strong> (South African
butterflies) with <code><a href="../reference/get_occurrence_data.html">get_occurrence_data()</a></code>, demonstrating how
to pull records from local files, remote URLs, or GBIF archives.<br>
</li>
<li>
<strong>Tidied the records</strong> into long and wide analytical
formats via <code><a href="../reference/format_df.html">format_df()</a></code>—crucially <em>without changing the
native spatial resolution</em> of the observations.<br>
</li>
<li>
<strong>Defined a study extent and analysis grid</strong>, creating
a masked raster template that will act as the spatial backbone for
downstream compositional dissimilarity and turnover analyses.</li>
</ol>
<p>Execute each chunk in the order presented (the chunk labels mirror
the headings) or adapt them to your own taxonomic group, area of
interest, or grid resolution. All subsequent vignettes assume you have
completed this workflow and have the resulting <code>site_obs</code>,
<code>site_spp</code>, and grid objects in your workspace.</p>
<hr>
<div class="section level4">
<h4 id="install-and-load-dissmapr">Install and load <code>dissmapr</code><a class="anchor" aria-label="anchor" href="#install-and-load-dissmapr"></a>
</h4>
<p>Install and load the <code>dissmapr</code> package from GitHub,
ensuring all functions are available for use in the workflow.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install remotes if needed</span></span>
<span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"macSands/dissmapr"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ensure the package is loaded when knitting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/macSands/dissmapr" class="external-link">dissmapr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make sure all the functions are loaded</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level4">
<h4 id="load-other-r-libraries">Load other R libraries<a class="anchor" aria-label="anchor" href="#load-other-r-libraries"></a>
</h4>
<p>Load core libraries for spatial processing, biodiversity modelling,
and visualization required across the <code>dissmapr</code> analysis
pipeline.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/" class="external-link">httr</a></span><span class="op">)</span>       <span class="co"># HTTP client  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span>    <span class="co"># Download geographic data  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co"># Fast large-table operations  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>      <span class="co"># Data manipulation verbs  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>      <span class="co"># Tidy data reshaping  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/" class="external-link">zoo</a></span><span class="op">)</span>        <span class="co"># Time series utilities  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>         <span class="co"># Vector spatial data  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span>      <span class="co"># Raster spatial operations  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span>  <span class="co"># supplies geom_spatraster()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">zetadiv</span><span class="op">)</span>    <span class="co"># Multi-site dissimilarity modelling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>    <span class="co"># Grammar of graphics  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span>    <span class="co"># Perceptual color scales  </span></span></code></pre></div>
<hr>
</div>
<div class="section level4">
<h4 id="get-species-occurrence-records-using-get_occurrence_data">Get species occurrence records using
<code>get_occurrence_data()</code><a class="anchor" aria-label="anchor" href="#get-species-occurrence-records-using-get_occurrence_data"></a>
</h4>
<p>To contextualise the following steps of the workflow, we use the
butterfly data in South Africa, accessed from GBIF, as the case for
demonstration. Ultimately, the choice for the AoI and taxa is
user-specific. This section focuses on automating the retrieval and
pre-processing of biodiversity occurrence data from various sources,
including:</p>
<ul>
<li>
<strong>local</strong> <code>databases</code>.csv` files,</li>
<li>
<strong>URLs</strong> or <code>.zip</code> files from the Global
Biodiversity Information Facility (GBIF), and</li>
<li>species <strong>occurrence cubes</strong> from B3 (specification)
[<em>work in progress</em>].</li>
</ul>
<p>The function assembles data on species distributions across specified
taxonomic groups and regions, producing presence-absence or abundance
matrices that quantify species co-occurrence within locations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bfly_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_occurrence_data.html">get_occurrence_data</a></span><span class="op">(</span></span>
<span>  data        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"gbif_butterflies.csv"</span>, package <span class="op">=</span> <span class="st">"dissmapr"</span><span class="op">)</span>,</span>
<span>  source_type <span class="op">=</span> <span class="st">'local_csv'</span>,</span>
<span>  sep         <span class="op">=</span> <span class="st">'\t'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bfly_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 81825    52</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bfly_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    81825 obs. of  52 variables:</span></span>
<span><span class="co">#&gt;  $ gbifID                          : num  9.23e+08 9.23e+08 9.23e+08 9.22e+08 9.22e+08 ...</span></span>
<span><span class="co">#&gt;  $ datasetKey                      : chr  "6ac3f774-d9fb-4796-b3e9-92bf6c81c084" "6ac3f774-d9fb-4796-b3e9-92bf6c81c084" "6ac3f774-d9fb-4796-b3e9-92bf6c81c084" "6ac3f774-d9fb-4796-b3e9-92bf6c81c084" ...</span></span>
<span><span class="co">#&gt;  $ occurrenceID                    : chr  "" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ kingdom                         : chr  "Animalia" "Animalia" "Animalia" "Animalia" ...</span></span>
<span><span class="co">#&gt;  $ phylum                          : chr  "Arthropoda" "Arthropoda" "Arthropoda" "Arthropoda" ...</span></span>
<span><span class="co">#&gt;  $ class                           : chr  "Insecta" "Insecta" "Insecta" "Insecta" ...</span></span>
<span><span class="co">#&gt;  $ order                           : chr  "Lepidoptera" "Lepidoptera" "Lepidoptera" "Lepidoptera" ...</span></span>
<span><span class="co">#&gt;  $ family                          : chr  "Pieridae" "Pieridae" "Papilionidae" "Pieridae" ...</span></span>
<span><span class="co">#&gt;  $ genus                           : chr  "Pieris" "Pieris" "Papilio" "Mylothris" ...</span></span>
<span><span class="co">#&gt;  $ sp_name                         : chr  "Pieris brassicae" "Pieris brassicae" "Papilio demodocus" "Mylothris agathina" ...</span></span>
<span><span class="co">#&gt;  $ infraspecificEpithet            : chr  "" "" "" "agathina" ...</span></span>
<span><span class="co">#&gt;  $ taxonRank                       : chr  "SPECIES" "SPECIES" "SPECIES" "SUBSPECIES" ...</span></span>
<span><span class="co">#&gt;  $ scientificName                  : chr  "Pieris brassicae (Linnaeus, 1758)" "Pieris brassicae (Linnaeus, 1758)" "Papilio demodocus Esper, 1798" "Mylothris agathina agathina" ...</span></span>
<span><span class="co">#&gt;  $ verbatimScientificName          : chr  "Pieris brassicae" "Pieris brassicae" "Papilio demodocus subsp. demodocus" "Mylothris agathina subsp. agathina" ...</span></span>
<span><span class="co">#&gt;  $ verbatimScientificNameAuthorship: logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ countryCode                     : chr  "ZA" "ZA" "ZA" "ZA" ...</span></span>
<span><span class="co">#&gt;  $ locality                        : chr  "Hermanus" "Polkadraai Road" "Signal Hill" "Hermanus" ...</span></span>
<span><span class="co">#&gt;  $ stateProvince                   : chr  "" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ occurrenceStatus                : chr  "PRESENT" "PRESENT" "PRESENT" "PRESENT" ...</span></span>
<span><span class="co">#&gt;  $ individualCount                 : int  NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ publishingOrgKey                : chr  "bb646dff-a905-4403-a49b-6d378c2cf0d9" "bb646dff-a905-4403-a49b-6d378c2cf0d9" "bb646dff-a905-4403-a49b-6d378c2cf0d9" "bb646dff-a905-4403-a49b-6d378c2cf0d9" ...</span></span>
<span><span class="co">#&gt;  $ y                               : num  -34.4 -34 -33.9 -34.4 -34.4 ...</span></span>
<span><span class="co">#&gt;  $ x                               : num  19.2 18.8 18.4 19.2 18.5 ...</span></span>
<span><span class="co">#&gt;  $ coordinateUncertaintyInMeters   : num  250 250 250 250 250 250 250 250 250 250 ...</span></span>
<span><span class="co">#&gt;  $ coordinatePrecision             : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ elevation                       : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ elevationAccuracy               : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ depth                           : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ depthAccuracy                   : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ eventDate                       : chr  "2012-10-13T00:00" "2012-11-01T00:00" "2012-10-31T00:00" "2012-10-13T00:00" ...</span></span>
<span><span class="co">#&gt;  $ day                             : int  13 1 31 13 30 23 20 22 21 22 ...</span></span>
<span><span class="co">#&gt;  $ month                           : int  10 11 10 10 10 10 10 10 10 10 ...</span></span>
<span><span class="co">#&gt;  $ year                            : int  2012 2012 2012 2012 2012 2012 2012 2012 2012 2012 ...</span></span>
<span><span class="co">#&gt;  $ taxonKey                        : int  1920506 1920506 1938125 11374894 6113873 6118817 6118817 6118871 1919924 1770649 ...</span></span>
<span><span class="co">#&gt;  $ speciesKey                      : int  1920506 1920506 1938125 5137998 6113873 1954382 1954382 1964076 1919924 1770649 ...</span></span>
<span><span class="co">#&gt;  $ basisOfRecord                   : chr  "HUMAN_OBSERVATION" "HUMAN_OBSERVATION" "HUMAN_OBSERVATION" "HUMAN_OBSERVATION" ...</span></span>
<span><span class="co">#&gt;  $ institutionCode                 : chr  "naturgucker" "naturgucker" "naturgucker" "naturgucker" ...</span></span>
<span><span class="co">#&gt;  $ collectionCode                  : chr  "naturgucker" "naturgucker" "naturgucker" "naturgucker" ...</span></span>
<span><span class="co">#&gt;  $ catalogNumber                   : chr  "-190723441" "2051102952" "1565945073" "-1879976251" ...</span></span>
<span><span class="co">#&gt;  $ recordNumber                    : chr  "" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ identifiedBy                    : chr  "" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ dateIdentified                  : chr  "" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ license                         : chr  "CC_BY_4_0" "CC_BY_4_0" "CC_BY_4_0" "CC_BY_4_0" ...</span></span>
<span><span class="co">#&gt;  $ rightsHolder                    : chr  "" "" "" "" ...</span></span>
<span><span class="co">#&gt;  $ recordedBy                      : chr  "591374253" "591374253" "591374253" "591374253" ...</span></span>
<span><span class="co">#&gt;  $ typeStatus                      : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ establishmentMeans              : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ lastInterpreted                 : chr  "2024-03-15T23:20:20.346Z" "2024-03-15T23:22:38.206Z" "2024-03-15T23:26:59.721Z" "2024-03-15T23:23:55.839Z" ...</span></span>
<span><span class="co">#&gt;  $ mediaType                       : chr  "" "" "" "StillImage" ...</span></span>
<span><span class="co">#&gt;  $ issue                           : chr  "COORDINATE_ROUNDED;GEODETIC_DATUM_ASSUMED_WGS84;CONTINENT_DERIVED_FROM_COORDINATES;MULTIMEDIA_URI_INVALID" "COORDINATE_ROUNDED;GEODETIC_DATUM_ASSUMED_WGS84;CONTINENT_DERIVED_FROM_COORDINATES;MULTIMEDIA_URI_INVALID" "COORDINATE_ROUNDED;GEODETIC_DATUM_ASSUMED_WGS84;CONTINENT_DERIVED_FROM_COORDINATES;TAXON_MATCH_HIGHERRANK;MULTI"| __truncated__ "COORDINATE_ROUNDED;GEODETIC_DATUM_ASSUMED_WGS84;CONTINENT_DERIVED_FROM_COORDINATES" ...</span></span>
<span><span class="co">#&gt;  $ site_id                         : int  1 2 3 1 4 5 5 5 5 5 ...</span></span>
<span><span class="co">#&gt;  $ pa                              : num  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bfly_data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;      gbifID                           datasetKey occurrenceID  kingdom</span></span>
<span><span class="co">#&gt; 1 923051749 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia</span></span>
<span><span class="co">#&gt; 2 922985630 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia</span></span>
<span><span class="co">#&gt; 3 922619348 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia</span></span>
<span><span class="co">#&gt; 4 922426210 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia</span></span>
<span><span class="co">#&gt; 5 921650584 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia</span></span>
<span><span class="co">#&gt; 6 921485695 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia</span></span>
<span><span class="co">#&gt;       phylum   class</span></span>
<span><span class="co">#&gt; 1 Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 2 Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 3 Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 4 Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 5 Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 6 Arthropoda Insecta</span></span></code></pre></div>
<hr>
</div>
<div class="section level4">
<h4 id="format-data-using-format_df">Format data using <code>format_df()</code><a class="anchor" aria-label="anchor" href="#format-data-using-format_df"></a>
</h4>
<p>Use <code>format_df</code> to <em>standardise and reshape</em> raw
biodiversity tables into the <em>long</em> or <em>wide</em> format
required by later <code>dissmapr</code> steps. Importantly, this
function does not alter the spatial resolution of the original
observations - it simply tidies the data by automatically identifying
key columns (e.g., coordinates, species, and values), assigning missing
observation/site IDs, and reformatting the data for analysis. Outputs
include a cleaned <code>site_obs</code> dataset and
<code>site_spp</code> matrix for further processing:</p>
<ul>
<li>
<strong>site_obs</strong>: Simplified table with unique
<code>site_id</code>, <code>x</code>, <code>y</code>,
<code>species</code> and <code>value</code> records (long format).</li>
<li>
<strong>site_spp</strong>: Site-by-species matrix for biodiversity
assessments (wide format).</li>
</ul>
<div class="section level5">
<h5 id="format-data-into-long-site_obs-and-wide-site_spp-formats">Format data into long (site_obs) and wide (site_spp) formats<a class="anchor" aria-label="anchor" href="#format-data-into-long-site_obs-and-wide-site_spp-formats"></a>
</h5>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bfly_result</span> <span class="op">=</span> <span class="fu"><a href="../reference/format_df.html">format_df</a></span><span class="op">(</span></span>
<span>  data        <span class="op">=</span> <span class="va">bfly_data</span>, <span class="co"># A `data.frame` of biodiversity records</span></span>
<span>  species_col <span class="op">=</span> <span class="st">'verbatimScientificName'</span>, <span class="co"># Name of species column (required for `"long"`)</span></span>
<span>  value_col   <span class="op">=</span> <span class="st">'pa'</span>, <span class="co"># Name of value column (e.g. presence/abundance; for `"long"`)</span></span>
<span>  extra_cols  <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Character vector of other columns to keep</span></span>
<span>  format      <span class="op">=</span> <span class="st">'long'</span> <span class="co"># Either`"long"` or `"wide"`. If `NULL`, inferred from `species_col` &amp; `value_col`</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check `bfly_result` structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bfly_result</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ site_obs:'data.frame':    79953 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ site_spp: tibble [56,090 × 2,871] (S3: tbl_df/tbl/data.frame)</span></span>
<span></span>
<span><span class="co"># Optional: Create new objects from list items</span></span>
<span><span class="va">site_obs</span> <span class="op">=</span> <span class="va">bfly_result</span><span class="op">$</span><span class="va">site_obs</span></span>
<span><span class="va">site_spp</span> <span class="op">=</span> <span class="va">bfly_result</span><span class="op">$</span><span class="va">site_spp</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 79953     5</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   site_id        x         y                            species value</span></span>
<span><span class="co">#&gt; 1       1 19.24410 -34.42086                   Pieris brassicae     1</span></span>
<span><span class="co">#&gt; 2       2 18.75564 -33.96044                   Pieris brassicae     1</span></span>
<span><span class="co">#&gt; 3       3 18.40321 -33.91651 Papilio demodocus subsp. demodocus     1</span></span>
<span><span class="co">#&gt; 4       1 19.24410 -34.42086 Mylothris agathina subsp. agathina     1</span></span>
<span><span class="co">#&gt; 5       4 18.47488 -34.35024                  Eutricha capensis     1</span></span>
<span><span class="co">#&gt; 6       5 25.65097 -33.58570            Drepanogynis bifasciata     1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 56090  2871</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   site_id     x     y `Mylothris agathina subsp. agathina` `Pieris brassicae`</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       1  19.2 -<span style="color: #BB0000;">34.4</span>                                    1                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       2  18.8 -<span style="color: #BB0000;">34.0</span>                                    0                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       3  18.4 -<span style="color: #BB0000;">33.9</span>                                    0                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>       4  18.5 -<span style="color: #BB0000;">34.4</span>                                    0                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>       5  25.7 -<span style="color: #BB0000;">33.6</span>                                    0                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>       6  22.2 -<span style="color: #BB0000;">33.6</span>                                    0                  0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: `Tarucus thespis` &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co">#### Get parameters from processed data to use later</span></span>
<span><span class="co"># Number of species</span></span>
<span><span class="op">(</span><span class="va">n_sp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2868</span></span>
<span></span>
<span><span class="co"># Species names</span></span>
<span><span class="va">sp_cols</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sp_cols</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "Mylothris agathina subsp. agathina" "Pieris brassicae"                  </span></span>
<span><span class="co">#&gt;  [3] "Tarucus thespis"                    "Acraea horta"                      </span></span>
<span><span class="co">#&gt;  [5] "Danaus chrysippus"                  "Papilio demodocus subsp. demodocus"</span></span>
<span><span class="co">#&gt;  [7] "Eutricha capensis"                  "Mesocelis monticola"               </span></span>
<span><span class="co">#&gt;  [9] "Vanessa cardui"                     "Cuneisigna obstans"</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level4">
<h4 id="user-defined-area-of-interest-and-grid-resolution">User-defined area of interest and grid resolution<a class="anchor" aria-label="anchor" href="#user-defined-area-of-interest-and-grid-resolution"></a>
</h4>
<p>Load the spatial boundary data for South Africa to serve as the
geographic reference for all subsequent biodiversity analyses and
visualizations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read RSA shape file</span></span>
<span><span class="va">rsa</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"rsa.shp"</span>, package <span class="op">=</span> <span class="st">"dissmapr"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `rsa' from data source </span></span>
<span><span class="co">#&gt;   `D:\Methods\R\myR_Packages\myCompletePks\dissmapr\inst\extdata\rsa.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 16.45802 ymin: -34.83514 xmax: 32.89125 ymax: -22.12661</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span></span>
<span><span class="co"># Define your resolution and create mask to use later</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># 0.5 degrees is roughly 55km</span></span>
<span></span>
<span><span class="co"># Convert to a terra vector</span></span>
<span><span class="va">rsa_vect</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">rsa</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an empty raster over RSA at your desired resolution</span></span>
<span><span class="va">grid</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">rsa_vect</span>, resolution <span class="op">=</span> <span class="va">res</span>, crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">rsa_vect</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span>   <span class="co"># fill with dummy values</span></span>
<span></span>
<span><span class="co"># Mask everything outside the RSA boundary</span></span>
<span><span class="va">grid_masked</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">grid</span>, <span class="va">rsa_vect</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sandra MacFadyen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
