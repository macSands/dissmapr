<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workflow for Compositional Dissimilarity and Biodiversity Turnover Analysis • dissmapr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Workflow for Compositional Dissimilarity and Biodiversity Turnover Analysis">
<meta name="description" content="Tools to compute and map biodiversity turnover at the macroscale.">
<meta property="og:description" content="Tools to compute and map biodiversity turnover at the macroscale.">
<meta property="og:image" content="https://macsands.github.io/dissmapr/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">dissmapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/getting-started.html">getting-started</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/macSands/dissmapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><ul>
<li>
<a href="#dissmapr"><strong><code>dissmapr</code></strong>: Compositional Dissimilarity and Biodiversity Turnover Analysis</a><br>
</li>
<li><a href="#introduction">Introduction</a></li>
<li>
<a href="#step-by-step-workflow">Step-by-Step Workflow</a>
<ul>
<li><a href="#id_1-install-and-load-dissmapr">1. Install and load <code>dissmapr</code></a></li>
<li><a href="#id_2-load-other-r-libraries">2. Load other R libraries</a></li>
<li><a href="#id_3-user-defined-area-of-interest-and-grid-resolution">3. Load user-defined area of interest and set grid resolution</a></li>
<li><a href="#id_4-get-species-occurrence-records-using-get_occurrence_data">4. Get species occurrence records using <code>get_occurrence_data</code></a></li>
<li><a href="#id_5-format-data-using-format_df">5. Format data using <code>format_df</code></a></li>
<li><a href="#id_6-summarise-records-by-grid-centroid-using-generate_grid">6. Summarise records by grid centroid using <code>generate_grid</code></a></li>
<li><a href="#id_7-generate-site-by-species-matrix---site_spp">7. Fetch site by species matrix created using <code>generate_grid</code></a></li>
<li><a href="#id_8-generate-site-by-environment-matrix-using-get_enviro_data">8. Generate site by environment matrix using <code>get_enviro_data</code></a></li>
<li><a href="#id_9-change-coordinates-projection-using-sfst_transform">9. Change coordinates projection using <code>sf::st_transform</code></a></li>
<li><a href="#id_10-check-for-colinearity-using-rm_correlated">10. Check for colinearity using <code>rm_correlated</code></a></li>
<li><a href="#id_11-calculate-zeta-decline-for-orders-215">11. Calculate Zeta decline for orders 2:15</a></li>
<li><a href="#id_12-calculate-zeta-decay-for-orders-28">12. Calculate Zeta decay for orders 2:8</a></li>
<li><a href="#id_13-run-a-multi-site-generalised-dissimilarity-model-for-order-2">13. Run a Multi-Site Generalised Dissimilarity Model for order 2</a></li>
<li><a href="#id_14-predict-current-zeta-diversity-zeta2-using-predict_dissim">14. Predict current Zeta Diversity (zeta2) using <code>predict_dissim</code></a></li>
<li><a href="#id_15-run-clustering-analyses-using-map_bioreg">15. Run clustering analyses using <code>map_bioreg</code></a></li>
<li><a href="#id_16-predict-future-zeta-diversity-and-map-bioregion-change-using-map_bioregDiff">16. Predict future Zeta Diversity and map bioregion change using <code>map_bioregDiff</code></a></li>
<li><a href="#id_17-deposit-all-results-into-Zenodo">17. Deposit all results into Zenodo</a></li>
</ul>
</li>
</ul>
<!-- README.md is generated from README.Rmd. Please edit that file --><!-- badges: start -->
<!-- badges: end -->
<hr>
<div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="dissmapr">
<code>dissmapr</code><a class="anchor" aria-label="anchor" href="#dissmapr"></a>
</h1>
</div>
<div class="section level2">
<h2 id="a-novel-framework-for-automated-compositional-dissimilarity-and-biodiversity-turnover-analysis">A Novel Framework for Automated Compositional Dissimilarity and Biodiversity Turnover Analysis<a class="anchor" aria-label="anchor" href="#a-novel-framework-for-automated-compositional-dissimilarity-and-biodiversity-turnover-analysis"></a>
</h2>
<hr>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>dissmapr</code> is an R package for analysing compositional dissimilarity and biodiversity turnover across spatial gradients. It provides scalable, modular workflows that integrate species occurrence, environmental data, and multi-site metrics to quantify and predict biodiversity patterns. A core feature is the use of zeta diversity, which extends beyond pairwise comparisons to capture shared species across multiple sites—offering deeper insight into community assembly, turnover, and connectivity. By incorporating modern approaches such as multi-site Generalised Dissimilarity Modelling (MS-GDM), <code>dissmapr</code> enables robust mapping, bioregional classification, and scenario-based forecasting. Designed for flexibility and reproducibility, it supports biodiversity monitoring and conservation planning at landscape to regional scales.</p>
<hr>
</div>
<div class="section level2">
<h2 id="step-by-step-workflow">Step-by-Step Workflow<a class="anchor" aria-label="anchor" href="#step-by-step-workflow"></a>
</h2>
<p><code>dissmapr</code> implements a structured, reproducible workflow for analysing biodiversity patterns and delineating bioregions. Each function aligns with a specific step, guiding users from data acquisition to predictive mapping. The workflow begins with sourcing species occurrence and georeferenced environmental data, followed by data formatting and calculation of compositional turnover using zeta diversity metrics (via the <code>zetadiv</code> package). Multi-Site Generalized Dissimilarity Modelling (MS-GDM) is then applied to model and predict dissimilarity across landscapes. These predictions feed into the Dissimilarity Cube, which classifies spatial clusters of species composition into distinct bioregions. The framework supports the integration of historical and future climate data to assess shifts in biodiversity and detect emerging, shifting, or dissolving bioregions under global change. This step-by-step structure, mirrored in the accompanying tutorial sections, promotes accessibility, transparency, and ecological insight at multiple spatial and temporal scales.</p>
<hr>
<div class="section level3">
<h3 id="id_1-install-and-load-dissmapr">1. Install and load <code>dissmapr</code>
<a class="anchor" aria-label="anchor" href="#id_1-install-and-load-dissmapr"></a>
</h3>
<p>Install and load the <code>dissmapr</code> package from GitHub, ensuring all functions are available for use in the analysis workflow.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install remotes if needed</span></span>
<span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"macSands/dissmapr"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ensure the package is loaded when knitting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/macSands/dissmapr" class="external-link">dissmapr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make sure all the functions are loaded</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="id_2-load-other-r-libraries">2. Load other R libraries<a class="anchor" aria-label="anchor" href="#id_2-load-other-r-libraries"></a>
</h3>
<p>Load core libraries for spatial processing, biodiversity modelling, and visualization required across the <code>dissmapr</code> analysis pipeline.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/" class="external-link">httr</a></span><span class="op">)</span>       <span class="co"># HTTP client  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span>    <span class="co"># Download geographic data  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co"># Fast large-table operations  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>      <span class="co"># Data manipulation verbs  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>      <span class="co"># Tidy data reshaping  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/" class="external-link">zoo</a></span><span class="op">)</span>        <span class="co"># Time series utilities  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>         <span class="co"># Vector spatial data  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span>      <span class="co"># Raster spatial operations  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">zetadiv</span><span class="op">)</span>    <span class="co"># Multi-site biodiversity turnover  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>    <span class="co"># Grammar of graphics  </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span>    <span class="co"># Perceptual color scales  </span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="id_3-user-defined-area-of-interest-and-grid-resolution">3. User-defined area of interest and grid resolution<a class="anchor" aria-label="anchor" href="#id_3-user-defined-area-of-interest-and-grid-resolution"></a>
</h3>
<p>Load the spatial boundary data for South Africa to serve as the geographic reference for all subsequent biodiversity analyses and visualizations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read RSA shape file</span></span>
<span><span class="va">rsa</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">'inst/extdata/rsa.shp'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `rsa' from data source </span></span>
<span><span class="co">#&gt;   `D:\Methods\R\myR_Packages\myCompletePks\dissmapr\inst\extdata\rsa.shp' using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 16.45802 ymin: -34.83514 xmax: 32.89125 ymax: -22.12661</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span></span>
<span><span class="co"># Define your resolution and create mask to use later</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># 0.5 degrees is roughly 55km</span></span>
<span></span>
<span><span class="co"># Convert to a terra vector</span></span>
<span><span class="va">rsa_vect</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">rsa</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an empty raster over RSA at your desired resolution</span></span>
<span><span class="va">grid</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">rsa_vect</span>, resolution <span class="op">=</span> <span class="va">res</span>, crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">rsa_vect</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span>   <span class="co"># fill with dummy values</span></span>
<span></span>
<span><span class="co"># Mask everything outside the RSA boundary</span></span>
<span><span class="va">grid_masked</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">grid</span>, <span class="va">rsa_vect</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="id_4-get-species-occurrence-records-using-get_occurrence_data">4. Get species occurrence records using <code>get_occurrence_data</code>
<a class="anchor" aria-label="anchor" href="#id_4-get-species-occurrence-records-using-get_occurrence_data"></a>
</h3>
<p>This section focuses on automating the retrieval and pre-processing of biodiversity occurrence data from various sources, including:</p>
<ol style="list-style-type: decimal">
<li>local <code>databases</code>.csv` files,</li>
<li>URLs or <code>.zip</code> files from the Global Biodiversity Information Facility (GBIF), and</li>
<li>species occurrence cubes from B3 (specification) [<em>work in progress</em>].</li>
</ol>
<p>The function assembles data on species distributions across specified taxonomic groups and regions, producing presence-absence or abundance matrices that quantify species co-occurrence within locations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bfly_data</span> <span class="op">=</span> <span class="fu"><a href="reference/get_occurrence_data.html">get_occurrence_data</a></span><span class="op">(</span></span>
<span>  data        <span class="op">=</span> <span class="st">'inst/extdata/gbif_butterflies.csv'</span>,</span>
<span>  source_type <span class="op">=</span> <span class="st">'local_csv'</span>,</span>
<span>  sep         <span class="op">=</span> <span class="st">'\t'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bfly_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 81825    52</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bfly_data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;      gbifID                           datasetKey occurrenceID  kingdom     phylum   class</span></span>
<span><span class="co">#&gt; 1 923051749 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 2 922985630 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 3 922619348 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 4 922426210 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 5 921650584 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia Arthropoda Insecta</span></span>
<span><span class="co">#&gt; 6 921485695 6ac3f774-d9fb-4796-b3e9-92bf6c81c084              Animalia Arthropoda Insecta</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="id_5-format-data-using-format_df">5. Format data using <code>format_df</code>
<a class="anchor" aria-label="anchor" href="#id_5-format-data-using-format_df"></a>
</h3>
<p>Use <code>format_df</code> to standardise and reshape biodiversity data into long or wide formats. The function automatically identifies key columns (e.g., coordinates, species, and values), assigns missing site IDs, and reformats the data for analysis. Outputs include a cleaned dataset and species-site matrices for further processing:</p>
<p>• site_xy: Holds spatial coordinates of sampled sites.<br>
• site_sp: Site-by-species matrix for biodiversity assessments.</p>
<div class="section level4">
<h4 id="format-data-into-long-and-wide-formats">Format data into long and wide formats<a class="anchor" aria-label="anchor" href="#format-data-into-long-and-wide-formats"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bfly_result</span> <span class="op">=</span> <span class="fu"><a href="reference/format_df.html">format_df</a></span><span class="op">(</span></span>
<span>  data        <span class="op">=</span> <span class="va">bfly_data</span>,</span>
<span>  species_col <span class="op">=</span> <span class="st">'verbatimScientificName'</span>,</span>
<span>  value_col   <span class="op">=</span> <span class="st">'pa'</span>,</span>
<span>  extra_cols  <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  format      <span class="op">=</span> <span class="st">'long'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: Create new objects from list items</span></span>
<span><span class="va">site_obs</span> <span class="op">=</span> <span class="va">bfly_result</span><span class="op">$</span><span class="va">site_obs</span></span>
<span><span class="va">site_spp</span> <span class="op">=</span> <span class="va">bfly_result</span><span class="op">$</span><span class="va">site_sp</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 79953     5</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   site_id        x         y                            species value</span></span>
<span><span class="co">#&gt; 1       1 19.24410 -34.42086                   Pieris brassicae     1</span></span>
<span><span class="co">#&gt; 2       2 18.75564 -33.96044                   Pieris brassicae     1</span></span>
<span><span class="co">#&gt; 3       3 18.40321 -33.91651 Papilio demodocus subsp. demodocus     1</span></span>
<span><span class="co">#&gt; 4       1 19.24410 -34.42086 Mylothris agathina subsp. agathina     1</span></span>
<span><span class="co">#&gt; 5       4 18.47488 -34.35024                  Eutricha capensis     1</span></span>
<span><span class="co">#&gt; 6       5 25.65097 -33.58570            Drepanogynis bifasciata     1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 56090  2871</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span><span class="co">#&gt;   site_id     x     y `Mylothris agathina subsp. agathina` `Pieris brassicae` `Tarucus thespis`</span></span>
<span><span class="co">#&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;                                &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1       1  19.2 -34.4                                    1                  1                 1</span></span>
<span><span class="co">#&gt; 2       2  18.8 -34.0                                    0                  1                 0</span></span>
<span><span class="co">#&gt; 3       3  18.4 -33.9                                    0                  0                 0</span></span>
<span><span class="co">#&gt; 4       4  18.5 -34.4                                    0                  0                 0</span></span>
<span><span class="co">#&gt; 5       5  25.7 -33.6                                    0                  0                 0</span></span>
<span><span class="co">#&gt; 6       6  22.2 -33.6                                    0                  0                 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="get-parameters-to-use-later">Get parameters to use later<a class="anchor" aria-label="anchor" href="#get-parameters-to-use-later"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get parameters from processed data</span></span>
<span><span class="co"># Number of species columns</span></span>
<span><span class="op">(</span><span class="va">n_sp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2868</span></span>
<span></span>
<span><span class="co"># Species names</span></span>
<span><span class="va">sp_cols</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sp_cols</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="id_6-summarise-records-by-grid-centroid-using-generate_grid">6. Summarise records by grid centroid using <code>generate_grid</code>
<a class="anchor" aria-label="anchor" href="#id_6-summarise-records-by-grid-centroid-using-generate_grid"></a>
</h3>
<p>Use <code>generate_grid</code> to divide the study area, derived from the geographic extent of the occurrence data above, into grids of user-defined resolution, creating a spatial grid over a specified geographic extent. It assigns unique grid IDs to points and summarizes selected data columns within each grid cell. The function outputs a raster grid, grid polygons for visualization, and a data frame summarizing the contents of each grid cell, including totals and centroids. It is particularly useful for aggregating spatial data, such as biodiversity observations, into predefined spatial units for further analysis.</p>
<div class="section level4">
<h4 id="assign-records-to-a-grid-at-a-set-resolution-eg-05">Assign records to a grid at a set resolution (e.g. 0.5°)<a class="anchor" aria-label="anchor" href="#assign-records-to-a-grid-at-a-set-resolution-eg-05"></a>
</h4>
<p>Aggregate species records into equal-area grid cells to enable spatially standardized biodiversity analyses.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_list</span> <span class="op">=</span> <span class="fu"><a href="reference/generate_grid.html">generate_grid</a></span><span class="op">(</span></span>
<span>  data       <span class="op">=</span> <span class="va">site_spp</span>,</span>
<span>  x_col      <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  y_col      <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  grid_size  <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  sum_col_range <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span>,</span>
<span>  crs_epsg   <span class="op">=</span> <span class="fl">4326</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: Create new objects from list items</span></span>
<span><span class="va">aoi_grid</span> <span class="op">=</span> <span class="va">grid_list</span><span class="op">$</span><span class="va">grid_sf</span></span>
<span><span class="va">grid_spp</span> <span class="op">=</span> <span class="va">grid_list</span><span class="op">$</span><span class="va">block_sp</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">aoi_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1110    8</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aoi_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 6 fields</span></span>
<span><span class="co">#&gt; Active geometry column: geometry</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 15.5 ymin: -36 xmax: 18.5 ymax: -35.5</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   centroid_lon centroid_lat grid_id  mapsheet obs_sum spp_rich                       geometry</span></span>
<span><span class="co">#&gt; 1        15.75       -35.75       1 E015S36BB      NA       NA POLYGON ((15.5 -36, 16 -36,...</span></span>
<span><span class="co">#&gt; 2        16.25       -35.75       2 E016S36BB      NA       NA POLYGON ((16 -36, 16.5 -36,...</span></span>
<span><span class="co">#&gt; 3        16.75       -35.75       3 E016S36BB      NA       NA POLYGON ((16.5 -36, 17 -36,...</span></span>
<span><span class="co">#&gt; 4        17.25       -35.75       4 E017S36BB      NA       NA POLYGON ((17 -36, 17.5 -36,...</span></span>
<span><span class="co">#&gt; 5        17.75       -35.75       5 E017S36BB      NA       NA POLYGON ((17.5 -36, 18 -36,...</span></span>
<span><span class="co">#&gt; 6        18.25       -35.75       6 E018S36BB      NA       NA POLYGON ((18 -36, 18.5 -36,...</span></span>
<span><span class="co">#&gt;               centroid</span></span>
<span><span class="co">#&gt; 1 POINT (15.75 -35.75)</span></span>
<span><span class="co">#&gt; 2 POINT (16.25 -35.75)</span></span>
<span><span class="co">#&gt; 3 POINT (16.75 -35.75)</span></span>
<span><span class="co">#&gt; 4 POINT (17.25 -35.75)</span></span>
<span><span class="co">#&gt; 5 POINT (17.75 -35.75)</span></span>
<span><span class="co">#&gt; 6 POINT (18.25 -35.75)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">grid_spp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  415 2874</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grid_spp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat  mapsheet obs_sum spp_rich</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004 E028S23BB       3        2</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004 E029S23BB      41       31</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004 E029S23BB      10       10</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004 E030S23BB       7        7</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004 E030S23BB       6        6</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004 E031S23BB     107       76</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="generate-a-data-frame-xy-of-site-centroids">Generate a data frame ‘xy’ of site centroids<a class="anchor" aria-label="anchor" href="#generate-a-data-frame-xy-of-site-centroids"></a>
</h4>
<p>Extract longitude–latitude coordinates and summary metrics for each occupied grid cell.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Grid centroids with 'gird_id', 'centroid_lon', 'centroid_lat', 'obs_sum' and `spp_rich`</span></span>
<span><span class="va">grid_xy</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create species observations data.frame</span></span>
<span><span class="va">spp_obs</span> <span class="op">=</span> <span class="va">site_obs</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">grid_xy</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 415   5</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grid_xy</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat obs_sum spp_rich</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004       3        2</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004      41       31</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004      10       10</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004       7        7</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004       6        6</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004     107       76</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">spp_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 79953     5</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spp_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   site_id        x         y                            species value</span></span>
<span><span class="co">#&gt; 1       1 19.24410 -34.42086                   Pieris brassicae     1</span></span>
<span><span class="co">#&gt; 2       2 18.75564 -33.96044                   Pieris brassicae     1</span></span>
<span><span class="co">#&gt; 3       3 18.40321 -33.91651 Papilio demodocus subsp. demodocus     1</span></span>
<span><span class="co">#&gt; 4       1 19.24410 -34.42086 Mylothris agathina subsp. agathina     1</span></span>
<span><span class="co">#&gt; 5       4 18.47488 -34.35024                  Eutricha capensis     1</span></span>
<span><span class="co">#&gt; 6       5 25.65097 -33.58570            Drepanogynis bifasciata     1</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="generate-a-map-of-rsa-with-occupied-grid-cells-as-centroid-points">Generate a map of RSA with occupied grid cells as centroid points<a class="anchor" aria-label="anchor" href="#generate-a-map-of-rsa-with-occupied-grid-cells-as-centroid-points"></a>
</h4>
<p>Visualize observation density across South Africa using centroid-based mapping of gridded biodiversity data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_grid</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_spp</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">centroid_lon</span>, y <span class="op">=</span> <span class="va">centroid_lat</span>,</span>
<span>                 size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">obs_sum</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">obs_sum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rsa</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"0.5° Grid with Observation Counts"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-map-aoi-1.png" width="100%"></p>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="example-1---species-richness">Example 1 - Species Richness<a class="anchor" aria-label="anchor" href="#example-1---species-richness"></a>
</h3>
<p>Here we calculate species richness across sites in the block_sp dataset, again using the compute_orderwise function. The richness function is applied to the grid_id column for site identification, with species data specified by sp_cols. Orders 1 to 4 are computed i.e. for order=1, it computes basic species richness at individual sites, while higher orders (2 to 4) represent the differences in richness between pairwise and/or multi-site combinations. A subset of 1000 samples is used for higher-order computations to speed-up computation time. Parallel processing is enabled with 4 worker threads to improve performance. The output is a table summarizing species richness across specified orders.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute species richness (order 1) and the difference thereof for orders 2 to 4</span></span>
<span><span class="va">rich_o1234</span> <span class="op">=</span> <span class="fu"><a href="reference/compute_orderwise.html">compute_orderwise</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">grid_spp</span>,</span>
<span>  func <span class="op">=</span> <span class="va">richness</span>,</span>
<span>  site_col <span class="op">=</span> <span class="st">'grid_id'</span>,</span>
<span>  sp_cols <span class="op">=</span> <span class="va">sp_cols</span>,</span>
<span>  sample_no <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  order <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time elapsed for order 1: 0 minutes and 4.51 seconds</span></span>
<span><span class="co">#&gt; Time elapsed for order 2: 0 minutes and 13.64 seconds</span></span>
<span><span class="co">#&gt; Time elapsed for order 3: 0 minutes and 51.50 seconds</span></span>
<span><span class="co">#&gt; Time elapsed for order 4: 1 minutes and 59.10 seconds</span></span>
<span><span class="co">#&gt; Total computation time: 1 minutes and 59.11 seconds</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rich_o1234</span><span class="op">)</span></span>
<span><span class="co">#&gt;    site_from site_to order value</span></span>
<span><span class="co">#&gt;       &lt;char&gt;  &lt;char&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:      1026    &lt;NA&gt;     1     2</span></span>
<span><span class="co">#&gt; 2:      1027    &lt;NA&gt;     1    31</span></span>
<span><span class="co">#&gt; 3:      1028    &lt;NA&gt;     1    10</span></span>
<span><span class="co">#&gt; 4:      1029    &lt;NA&gt;     1     7</span></span>
<span><span class="co">#&gt; 5:      1030    &lt;NA&gt;     1     6</span></span>
<span><span class="co">#&gt; 6:      1031    &lt;NA&gt;     1    76</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot species richness distribution by order</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">order</span>,</span>
<span>        data <span class="op">=</span> <span class="va">rich_o1234</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#4575b4'</span>, <span class="st">'#99ce8f'</span>, <span class="st">'#fefab8'</span>, <span class="st">'#d73027'</span><span class="op">)</span>,</span>
<span>        horizontal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        outline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        main <span class="op">=</span> <span class="st">'Distribution of Species Richness by Order'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-richness-plot-1.png" width="100%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Link centroid coordinates back to `rich_o1234` data.frame for plotting</span></span>
<span><span class="va">rich_o1234</span><span class="op">$</span><span class="va">centroid_lon</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">$</span><span class="va">centroid_lon</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">rich_o1234</span><span class="op">$</span><span class="va">site_from</span>, <span class="va">grid_spp</span><span class="op">$</span><span class="va">grid_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">rich_o1234</span><span class="op">$</span><span class="va">centroid_lat</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">$</span><span class="va">centroid_lat</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">rich_o1234</span><span class="op">$</span><span class="va">site_from</span>, <span class="va">grid_spp</span><span class="op">$</span><span class="va">grid_id</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Summarise turnover by site (spatial location)</span></span>
<span><span class="va">mean_rich_o1234</span> <span class="op">=</span> <span class="va">rich_o1234</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">order</span>, <span class="va">site_from</span>, <span class="va">centroid_lon</span>, <span class="va">centroid_lat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mean_rich_o1234</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span><span class="co">#&gt; # Groups:   order, site_from, centroid_lon [6]</span></span>
<span><span class="co">#&gt;   order site_from centroid_lon centroid_lat value</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1 1026              28.8        -22.3     2</span></span>
<span><span class="co">#&gt; 2     1 1027              29.2        -22.3    31</span></span>
<span><span class="co">#&gt; 3     1 1028              29.7        -22.3    10</span></span>
<span><span class="co">#&gt; 4     1 1029              30.3        -22.3     7</span></span>
<span><span class="co">#&gt; 5     1 1030              30.8        -22.3     6</span></span>
<span><span class="co">#&gt; 6     1 1031              31.3        -22.3    76</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="example-2---community-turnover">Example 2 - Community Turnover<a class="anchor" aria-label="anchor" href="#example-2---community-turnover"></a>
</h3>
<p>Here we calculate species turnover (beta diversity) across sites in the block_sp dataset using the compute_orderwise function again. The turnover function is applied to the grid_id column for site identification, with species data specified by sp_cols. Order = 1 is not an option because turnover requires a comparison between sites. For orders 2 to 5, it computes turnover for pairwise and higher-order site combinations, representing the proportion of species not shared between sites. A subset of 1000 samples is used for higher-order comparisons. Parallel processing with 4 worker threads improves efficiency, and the output is a table summarizing species turnover across the specified orders.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute community turnover for orders 2 to 5</span></span>
<span><span class="va">turn_o2345</span> <span class="op">=</span> <span class="fu"><a href="reference/compute_orderwise.html">compute_orderwise</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">grid_spp</span>,</span>
<span>  func <span class="op">=</span> <span class="va">turnover</span>,</span>
<span>  site_col <span class="op">=</span> <span class="st">'grid_id'</span>,</span>
<span>  sp_cols <span class="op">=</span> <span class="va">sp_cols</span>, <span class="co"># OR `names(grid_spp)[-c(1:4)]`</span></span>
<span>  sample_no <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># Reduce to speed-up computation</span></span>
<span>  order <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time elapsed for order 2: 0 minutes and 17.00 seconds</span></span>
<span><span class="co">#&gt; Time elapsed for order 3: 1 minutes and 25.83 seconds</span></span>
<span><span class="co">#&gt; Time elapsed for order 4: 2 minutes and 45.40 seconds</span></span>
<span><span class="co">#&gt; Time elapsed for order 5: 4 minutes and 29.85 seconds</span></span>
<span><span class="co">#&gt; Total computation time: 4 minutes and 29.87 seconds</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">turn_o2345</span><span class="op">)</span></span>
<span><span class="co">#&gt;    site_from site_to order     value</span></span>
<span><span class="co">#&gt;       &lt;char&gt;  &lt;char&gt; &lt;int&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1027    1026     2 0.9354839</span></span>
<span><span class="co">#&gt; 2:      1028    1026     2 0.9090909</span></span>
<span><span class="co">#&gt; 3:      1029    1026     2 1.0000000</span></span>
<span><span class="co">#&gt; 4:      1030    1026     2 1.0000000</span></span>
<span><span class="co">#&gt; 5:      1031    1026     2 0.9870130</span></span>
<span><span class="co">#&gt; 6:       117    1026     2 1.0000000</span></span></code></pre></div>
<p>To visualize the spatial patterns of turnover across sites, geographic coordinates are added back to the results. This allows spatial exploration of turnover patterns across different orders, highlighting regions of high or low turnover and enabling comparisons across orders. These visualizations provide valuable insights into spatial biodiversity dynamics. Below we assign the geographic coordinates (x and y) from the block_sp dataset to the turn_o2345 results. Using match, it aligns the coordinates to the site_from column in turn_o2345 based on the corresponding grid_id values in block_sp. This prepares the dataset for spatial plotting.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add coordinates back to 'turn_o2345' for plotting</span></span>
<span><span class="va">turn_o2345</span><span class="op">$</span><span class="va">centroid_lon</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">$</span><span class="va">centroid_lon</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">turn_o2345</span><span class="op">$</span><span class="va">site_from</span>, <span class="va">grid_spp</span><span class="op">$</span><span class="va">grid_id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">turn_o2345</span><span class="op">$</span><span class="va">centroid_lat</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">$</span><span class="va">centroid_lat</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">turn_o2345</span><span class="op">$</span><span class="va">site_from</span>, <span class="va">grid_spp</span><span class="op">$</span><span class="va">grid_id</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Summarise turnover by site (spatial location)</span></span>
<span><span class="va">mean_turn_o2345</span> <span class="op">=</span> <span class="va">turn_o2345</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">order</span>, <span class="va">site_from</span>, <span class="va">centroid_lon</span>, <span class="va">centroid_lat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot Beta Diversity (pairwise turnover i.e. only order 2) calculated using `compute_orderwise(..., func = turnover, ...)`</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_turn_o2345</span><span class="op">[</span><span class="va">mean_turn_o2345</span><span class="op">$</span><span class="va">order</span><span class="op">==</span><span class="fl">2</span>,<span class="op">]</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">centroid_lon</span>, y <span class="op">=</span> <span class="va">centroid_lat</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#Apply viridis color palette</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rsa</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span>, fill <span class="op">=</span> <span class="st">"Beta Diversity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-turnover-plot-order2-1.png" width="100%"></p>
<p>Plot order-wise turnover (orders 2:5) calculated using <code>compute_orderwise(..., func = turnover, ...)</code> to visualise spatial patterns of turnover across different orders. Results highlight regions of high or low turnover and facilitate comparison across orders, providing insights into spatial biodiversity dynamics.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot order-wise turnover (orders 2:5) calculated using `compute_orderwise(..., func = turnover, ...)`</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mean_turn_o2345</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">centroid_lon</span>, y <span class="op">=</span> <span class="va">centroid_lat</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span>, name <span class="op">=</span> <span class="st">"Turnover"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rsa</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Mean Turnover by Order"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Longitude"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Latitude"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">order</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-turnover-plot-orders2345-1.png" width="100%"></p>
<hr>
</div>
<div class="section level3">
<h3 id="id_7-generate-site-by-species-matrix---site_spp">7. Generate site by species matrix - <code>site_spp</code>
<a class="anchor" aria-label="anchor" href="#id_7-generate-site-by-species-matrix---site_spp"></a>
</h3>
<p>Create a matrix of species counts per site for use in biodiversity and dissimilarity analyses.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">site_spp</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">grid_spp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 415   2</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span></span>
<span><span class="co">#&gt;   centroid_lon centroid_lat</span></span>
<span><span class="co">#&gt; 1        28.75    -22.25004</span></span>
<span><span class="co">#&gt; 2        29.25    -22.25004</span></span>
<span><span class="co">#&gt; 3        29.75    -22.25004</span></span>
<span><span class="co">#&gt; 4        30.25    -22.25004</span></span>
<span><span class="co">#&gt; 5        30.75    -22.25004</span></span>
<span><span class="co">#&gt; 6        31.25    -22.25004</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  415 2873</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_spp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat obs_sum spp_rich Mylothris agathina subsp. agathina</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004       3        2                                  0</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004      41       31                                  0</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004      10       10                                  0</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004       7        7                                  0</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004       6        6                                  0</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004     107       76                                  0</span></span></code></pre></div>
<div class="section level4">
<h4 id="fetch-record-of-occurrence-counts-calculated-using-generate_grid">Fetch record of occurrence counts calculated using <code>generate_grid</code>
<a class="anchor" aria-label="anchor" href="#fetch-record-of-occurrence-counts-calculated-using-generate_grid"></a>
</h4>
<p><code>generate_grid</code> summarised the number of species observations per grid cell to assess sampling effort.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sampling effort = observation counts</span></span>
<span><span class="va">sam_eff</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grid_id"</span>,<span class="st">"centroid_lon"</span>,<span class="st">"centroid_lat"</span>,<span class="st">"obs_sum"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">obs_cnt</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">obs_cnt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 415   4</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obs_cnt</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat obs_sum</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004       3</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004      41</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004      10</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004       7</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004       6</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004     107</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="generate-a-binary-presenceabsence-data-frame-sbs">Generate a binary (presence/absence) data frame ‘sbs’<a class="anchor" aria-label="anchor" href="#generate-a-binary-presenceabsence-data-frame-sbs"></a>
</h4>
<p>Convert species abundance data to presence/absence format (<code>site_spp_pa</code>) for binary dissimilarity analyses.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create site-by-species matrix</span></span>
<span><span class="va">sbs</span> <span class="op">=</span> <span class="va">site_spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">sp_cols</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sbs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  415 2873</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sbs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat obs_sum spp_rich Mylothris agathina subsp. agathina</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004       3        2                                  0</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004      41       31                                  0</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004      10       10                                  0</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004       7        7                                  0</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004       6        6                                  0</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004     107       76                                  0</span></span>
<span></span>
<span><span class="co"># Assuming 'sp_cols' is a vector of column names</span></span>
<span><span class="va">site_spp_pa</span> <span class="op">=</span> <span class="va">site_spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">sp_cols</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">.</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  415 2873</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat obs_sum spp_rich Mylothris agathina subsp. agathina</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004       3        2                                  0</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004      41       31                                  0</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004      10       10                                  0</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004       7        7                                  0</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004       6        6                                  0</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004     107       76                                  0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fetch-species-richness-values-calculated-using-generate_grid">Fetch species richness values calculated using <code>generate_grid</code>
<a class="anchor" aria-label="anchor" href="#fetch-species-richness-values-calculated-using-generate_grid"></a>
</h4>
<p><code>generate_grid</code> calculated species richness per site based on binary presence/absence records.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Species richness</span></span>
<span><span class="va">spp_rich</span> <span class="op">=</span> <span class="va">grid_spp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grid_id"</span>,<span class="st">"centroid_lon"</span>,<span class="st">"centroid_lat"</span>,<span class="st">"spp_rich"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  415 2873</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat obs_sum spp_rich Mylothris agathina subsp. agathina</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004       3        2                                  0</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004      41       31                                  0</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004      10       10                                  0</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004       7        7                                  0</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004       6        6                                  0</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004     107       76                                  0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="generate-obs_cnt-and-spp_rich-raster-maps">Generate ‘obs_cnt’ and ‘spp_rich’ raster maps<a class="anchor" aria-label="anchor" href="#generate-obs_cnt-and-spp_rich-raster-maps"></a>
</h4>
<p><code>generate_grid</code> also creates a <code>SpatRast</code> to help visualise sampling effort and species richness over the study area.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Species richness and sampling effort SpatRast</span></span>
<span><span class="va">ras_effRich</span> <span class="op">=</span> <span class="va">grid_list</span><span class="op">$</span><span class="va">grid</span><span class="op">[[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot `ras_effRich` using colour palettes from `viridis`</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ras_effRich</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">turbo</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-eff-rich-1.png" width="100%"></p>
<p><em><strong>Note</strong>: occurrence coordinates are only used for assigning then into grids; they are not needed beyond this step.</em></p>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="id_8-generate-site-by-environment-matrix-using-get_enviro_data">8. Generate site by environment matrix using <code>get_enviro_data</code>
<a class="anchor" aria-label="anchor" href="#id_8-generate-site-by-environment-matrix-using-get_enviro_data"></a>
</h3>
<p>Use <code>get_enviro_data</code> to extract environmental variables for spatial points from either species observations or grid centroids. Data can be sourced from online repositories (e.g. <em>WorldClim</em>, <em>SoilGrids</em> via <code>geodata</code>) or local rasters. The function defines an area of interest with a buffer, extracts selected variables, and interpolates missing values using nearby non-NA points. Outputs include cropped rasters, spatial points (as an <code>sf</code> object), and a combined site-by-environment data frame (<code>site_env</code>) for downstream ecological analyses. Future support will extend to <em>CHELSA</em> (<code>climenv</code>), <em>Google Earth Engine</em> (<code>rgee</code>), and <code>mapme.biodiversity</code> for expanded environmental and biodiversity data access.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use `get_enviro_data` to fetch environmental data for your grid centroids</span></span>
<span><span class="va">enviro_list</span> <span class="op">=</span> <span class="fu"><a href="reference/get_enviro_data.html">get_enviro_data</a></span><span class="op">(</span></span>
<span>  data      <span class="op">=</span> <span class="va">sbs</span>,</span>
<span>  buffer_km <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  source    <span class="op">=</span> <span class="st">'geodata'</span>,</span>
<span>  var       <span class="op">=</span> <span class="st">"bio"</span>,</span>
<span>  res       <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  path      <span class="op">=</span> <span class="st">'download_data'</span>,</span>
<span>  sp_cols   <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sbs</span><span class="op">)</span>,</span>
<span>  ext_cols  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'obs_sum'</span>,<span class="st">'spp_rich'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: Create new objects from list items</span></span>
<span><span class="va">ras_enviro</span> <span class="op">=</span> <span class="va">enviro_list</span><span class="op">$</span><span class="va">env_rast</span></span>
<span></span>
<span><span class="co"># Optional: Rename the columns to something more descriptive</span></span>
<span><span class="va">names_env</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp_mean"</span>, <span class="st">"mdr"</span>, <span class="st">"iso"</span>, <span class="st">"temp_sea"</span>, <span class="st">"temp_max"</span>,</span>
<span>                    <span class="st">"temp_min"</span>, <span class="st">"temp_rang"</span>,<span class="st">"temp_wetQ"</span>,<span class="st">"temp_dryQ"</span>, <span class="st">"temp_warmQ"</span>,</span>
<span>                    <span class="st">"temp_coldQ"</span>, <span class="st">"rain_mean"</span>,<span class="st">"rain_wet"</span>, <span class="st">"rain_dry"</span>, <span class="st">"rain_sea"</span>,</span>
<span>                    <span class="st">"rain_wetQ"</span>, <span class="st">"rain_dryQ"</span>,<span class="st">"rain_warmQ"</span>, <span class="st">"rain_coldQ"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">enviro_list</span><span class="op">$</span><span class="va">env_rast</span><span class="op">)</span> <span class="op">=</span> <span class="va">names_env</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ras_enviro</span><span class="op">)</span> <span class="op">=</span> <span class="va">names_env</span></span></code></pre></div>
<div class="section level4">
<h4 id="add-eff-rich-raster-to-the-enviro-stack-raster">Add ‘eff-rich’ raster to the enviro stack raster<a class="anchor" aria-label="anchor" href="#add-eff-rich-raster-to-the-enviro-stack-raster"></a>
</h4>
<p>Combine environmental rasters with sampling effort and species richness layers for joint spatial analysis.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine `SpatRast`</span></span>
<span><span class="va">ras_enviro_effRich</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ras_effRich</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span><span class="va">ras_enviro</span>, <span class="va">ras_effRich</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the first 4 layers of `ras_enviro_effRich`</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ras_enviro_effRich</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-ras-1.png" width="100%"></p>
</div>
<div class="section level4">
<h4 id="create-dataframe-of-environmental-variables-with-site-centroids-xy">Create data.frame of environmental variables with site centroids ‘xy’<a class="anchor" aria-label="anchor" href="#create-dataframe-of-environmental-variables-with-site-centroids-xy"></a>
</h4>
<p>Environmental data were linked to grid centroids using <code>get_enviro_data</code>, now visualise the spatial variation in selected climate variables to check results.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create `env_df`</span></span>
<span><span class="va">env_df</span> <span class="op">=</span> <span class="va">enviro_list</span><span class="op">$</span><span class="va">env_df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">8</span><span class="op">:</span><span class="fl">26</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Make sure column names are correct</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">env_df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grid_id"</span>,<span class="st">"centroid_lon"</span>,<span class="st">"centroid_lat"</span>,<span class="st">"obs_sum"</span>,<span class="st">"spp_rich"</span>,<span class="st">"temp_mean"</span>,</span>
<span>                  <span class="st">"mdr"</span>, <span class="st">"iso"</span>, <span class="st">"temp_sea"</span>, <span class="st">"temp_max"</span>,</span>
<span>                    <span class="st">"temp_min"</span>, <span class="st">"temp_rang"</span>,<span class="st">"temp_wetQ"</span>,<span class="st">"temp_dryQ"</span>, <span class="st">"temp_warmQ"</span>,</span>
<span>                    <span class="st">"temp_coldQ"</span>, <span class="st">"rain_mean"</span>,<span class="st">"rain_wet"</span>, <span class="st">"rain_dry"</span>, <span class="st">"rain_sea"</span>,</span>
<span>                    <span class="st">"rain_wetQ"</span>, <span class="st">"rain_dryQ"</span>,<span class="st">"rain_warmQ"</span>, <span class="st">"rain_coldQ"</span><span class="op">)</span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">env_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 415  24</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">env_df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   grid_id centroid_lon centroid_lat obs_sum spp_rich temp_mean</span></span>
<span><span class="co">#&gt; 1    1026        28.75    -22.25004       3        2  21.88425</span></span>
<span><span class="co">#&gt; 2    1027        29.25    -22.25004      41       31  21.76921</span></span>
<span><span class="co">#&gt; 3    1028        29.75    -22.25004      10       10  21.53492</span></span>
<span><span class="co">#&gt; 4    1029        30.25    -22.25004       7        7  23.01796</span></span>
<span><span class="co">#&gt; 5    1030        30.75    -22.25004       6        6  23.59879</span></span>
<span><span class="co">#&gt; 6    1031        31.25    -22.25004     107       76  24.57367</span></span>
<span></span>
<span><span class="co"># Plot the results to check the conversion is accurate</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add 0.25deg grid layer</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi_grid</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add bfly points layer</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">env_df</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">centroid_lon</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">centroid_lat</span>,</span>
<span>                 size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">temp_mean</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="va">temp_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Use turbo color scale</span></span>
<span>  <span class="co"># Add boundary layer</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rsa</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"0.5° Grid Cells with temp_mean"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Longitude"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span>   </span></code></pre></div>
<p><img src="reference/figures/README-env-df-1.png" width="100%"></p>
</div>
<div class="section level4">
<h4 id="generate-site-by-environment-data-frame-sbe">Generate <em>Site-by-Environment</em> data frame ‘sbe’<a class="anchor" aria-label="anchor" href="#generate-site-by-environment-data-frame-sbe"></a>
</h4>
<p>Create a unified data frame of site coordinates, sampling effort, richness, and environmental variables for modelling called <code>sbe</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create `sbe` data.frame</span></span>
<span><span class="va">sbe</span> <span class="op">=</span> <span class="va">env_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">grid_id</span>, <span class="va">centroid_lon</span>, <span class="va">centroid_lat</span>, <span class="va">obs_sum</span>, <span class="va">spp_rich</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="id_9-change-coordinates-projection-using-sfst_transform">9. Change coordinates projection using <code>sf::st_transform</code>
<a class="anchor" aria-label="anchor" href="#id_9-change-coordinates-projection-using-sfst_transform"></a>
</h3>
<p>Reproject spatial coordinates from geographic (WGS84) to a projected system (e.g. Albers Equal Area) for analyses requiring distance in meters, such as spatial clustering or environmental modelling.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to sf object with WGS84 geographic CRS</span></span>
<span><span class="va">xy_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">xy</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"centroid_lon"</span>, <span class="st">"centroid_lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Project to Albers Equal Area (meters)</span></span>
<span><span class="va">xy_utm</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">xy_sf</span>, crs <span class="op">=</span> <span class="fl">9822</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract transformed coordinates in meters</span></span>
<span><span class="co"># Combine transformed coordinates back into data frame</span></span>
<span><span class="va">xy_utm_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xy</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">xy_utm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check results and compare coordinate formats</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span></span>
<span><span class="co">#&gt;   centroid_lon centroid_lat</span></span>
<span><span class="co">#&gt; 1        28.75    -22.25004</span></span>
<span><span class="co">#&gt; 2        29.25    -22.25004</span></span>
<span><span class="co">#&gt; 3        29.75    -22.25004</span></span>
<span><span class="co">#&gt; 4        30.25    -22.25004</span></span>
<span><span class="co">#&gt; 5        30.75    -22.25004</span></span>
<span><span class="co">#&gt; 6        31.25    -22.25004</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xy_utm_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   centroid_lon centroid_lat       X        Y</span></span>
<span><span class="co">#&gt; 1        28.75    -22.25004 6392274 -6836200</span></span>
<span><span class="co">#&gt; 2        29.25    -22.25004 6480542 -6808542</span></span>
<span><span class="co">#&gt; 3        29.75    -22.25004 6568648 -6780369</span></span>
<span><span class="co">#&gt; 4        30.25    -22.25004 6656587 -6751682</span></span>
<span><span class="co">#&gt; 5        30.75    -22.25004 6744357 -6722482</span></span>
<span><span class="co">#&gt; 6        31.25    -22.25004 6831955 -6692770</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="id_10-check-for-colinearity-using-rm_correlated">10. Check for colinearity using <code>rm_correlated</code>
<a class="anchor" aria-label="anchor" href="#id_10-check-for-colinearity-using-rm_correlated"></a>
</h3>
<p>Identify and remove highly correlated environmental variables to reduce multicollinearity in subsequent analyses. This step ensures model stability by retaining only informative, non-redundant predictors based on a user-defined correlation threshold.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove the highly correlated variables</span></span>
<span><span class="va">env_vars_reduced</span> <span class="op">=</span> <span class="fu"><a href="reference/rm_correlated.html">rm_correlated</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">env_df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                 cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 threshold <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>                                 plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-remove_var-1.png" width="100%"></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co">#&gt; Variables removed due to high correlation:</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="co">#&gt;  [1] "temp_rang"  "temp_sea"   "mdr"        "temp_max"   "rain_mean"  "rain_dryQ"  "temp_min"  </span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="co">#&gt;  [8] "temp_warmQ" "temp_coldQ" "rain_coldQ" "rain_wetQ"  "rain_wet"   "rain_sea"  </span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="co">#&gt; Variables retained:</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="co">#&gt; [1] "obs_sum"    "temp_mean"  "iso"        "temp_wetQ"  "temp_dryQ"  "rain_dry"   "rain_warmQ"</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="co"># Compare numbers of environmental variables</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="fu">ncol</span>(env_df[,<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">24</span>)])</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a><span class="co">#&gt; [1] 20</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="fu">ncol</span>(env_vars_reduced)</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="co">#&gt; [1] 7</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="id_11-calculate-zeta-decline-for-orders-215">11. Calculate Zeta decline for orders 2:15<a class="anchor" aria-label="anchor" href="#id_11-calculate-zeta-decline-for-orders-215"></a>
</h3>
<div class="section level4">
<h4 id="expectation-of-zeta-diversity-decline-using-zetadivzetadeclineex">Expectation of zeta diversity decline using <code>zetadiv::Zeta.decline.ex</code>
<a class="anchor" aria-label="anchor" href="#expectation-of-zeta-diversity-decline-using-zetadivzetadeclineex"></a>
</h4>
<p>Computes the expectation of zeta diversity, the number of species shared by multiple assemblages for a range of orders (number of assemblages or sites), using a formula based on the occupancy of the species, and fits the decline to an exponential and a power law relationship. <em>Generate statistics and figures, no maps</em></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zeta_decline_ex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zetadiv/man/Zeta.decline.ex.html" class="external-link">Zeta.decline.ex</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                                  orders <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-zeta-decline-ex-1.png" width="100%"></p>
<blockquote>
<ul>
<li>
<strong>Panel 1 (Zeta diversity decline)</strong>: Shows how rapidly species that are common across multiple sites decline as you look at groups of more and more sites simultaneously (increasing zeta order). The sharp drop means fewer species are shared among many sites compared to just a few.</li>
<li>
<strong>Panel 2 (Ratio of zeta diversity decline)</strong>: Illustrates the proportion of shared species that remain as the number of sites compared increases. A steeper curve indicates that common species quickly become rare across multiple sites.</li>
<li>
<strong>Panel 3 (Exponential regression)</strong>: Tests if the decline in shared species fits an exponential decrease. A straight line here indicates that species commonness decreases rapidly and consistently as more sites are considered together. Exponential regression represents <u><strong>stochastic assembly</strong></u> (<strong>randomness determining species distributions</strong>).</li>
<li>
<strong>Panel 4 (Power law regression)</strong>: Tests if the decline follows a power law relationship. A straight line suggests that the loss of common species follows a predictable pattern, where initially many species are shared among fewer sites, but rapidly fewer are shared among larger groups. Power law regression represents <u><strong>niche-based sorting</strong></u> (<strong>environmental factors shaping species distributions</strong>).</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Interpretation</strong>: The near‐perfect straight line in the exponential panel (high R²) indicates that an exponential model provides the most parsimonious description of how species shared across sites decline as you add more sites—consistent with a stochastic, memory-less decline in common species. A power law will also fit in broad strokes, but deviates at high orders, suggesting exponential decay is the better choice for these data.</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="zeta-diversity-decline-using-monte-carlo-sampling-zetadivzetadeclinemc">Zeta diversity decline using Monte Carlo sampling <code>zetadiv::Zeta.decline.mc</code>
<a class="anchor" aria-label="anchor" href="#zeta-diversity-decline-using-monte-carlo-sampling-zetadivzetadeclinemc"></a>
</h4>
<p>Computes zeta diversity, the number of species shared by multiple assemblages, for a range of orders (number of assemblages or sites), using combinations of sampled sites, and fits the decline to an exponential and a power law relationship. <em>Generate statistics and figures, no maps</em></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zeta_mc_utm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zetadiv/man/Zeta.decline.mc.html" class="external-link">Zeta.decline.mc</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                               <span class="va">xy_utm_df</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                               orders <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">15</span>,</span>
<span>                               sam <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                               NON <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               normalize <span class="op">=</span> <span class="st">"Jaccard"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-zeta-decline-mc-1.png" width="100%"></p>
<blockquote>
<ul>
<li>
<strong>Panel 1 (Zeta diversity decline)</strong>: Rapidly declining zeta diversity, similar to previous plots, indicates very few species remain shared across increasingly larger sets of sites, emphasizing strong species turnover and spatial specialization.</li>
<li>
<strong>Panel 2 (Ratio of zeta diversity decline)</strong>: More irregular fluctuations suggest a spatial effect: nearby sites might occasionally share more species by chance due to proximity. The spikes mean certain groups of neighboring sites have higher-than-average species overlap.</li>
<li>
<strong>Panel 3 &amp; 4 (Exponential and Power law regressions)</strong>: Both remain linear, clearly indicating the zeta diversity declines consistently following a predictable spatial pattern. However, the exact pattern remains similar to previous cases, highlighting that despite spatial constraints, common species become rare quickly as more sites are considered.<br><em>This result demonstrates clear spatial structuring of biodiversity—species are locally clustered, not randomly distributed across the landscape. Spatial proximity influences which species co-occur more frequently. In practice use <code>Zeta.decline.mc</code> for real‐world biodiversity data—both because it scales and because the Monte Carlo envelope is invaluable when ζₖ gets noisier at higher orders.</em>
</li>
</ul>
</blockquote>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="id_12-calculate-zeta-decay-for-orders-28">12. Calculate Zeta decay for orders 2:8<a class="anchor" aria-label="anchor" href="#id_12-calculate-zeta-decay-for-orders-28"></a>
</h3>
<div class="section level4">
<h4 id="zeta-distance-decay-for-a-range-of-numbers-of-assemblages-or-sites-using-zetadivzetaddecays">Zeta distance decay for a range of numbers of assemblages or sites using <code>zetadiv::Zeta.ddecays</code>
<a class="anchor" aria-label="anchor" href="#zeta-distance-decay-for-a-range-of-numbers-of-assemblages-or-sites-using-zetadivzetaddecays"></a>
</h4>
<p>Computes the distance decay of zeta diversity for a range of orders (number of assemblages or sites), using generalised linear models. <em>Generate statistics and figures, no maps</em></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate Zeta.ddecays</span></span>
<span><span class="va">zeta_decays</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zetadiv/man/Zeta.ddecays.html" class="external-link">Zeta.ddecays</a></span><span class="op">(</span><span class="va">xy_utm_df</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                          <span class="va">site_spp_pa</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                          sam <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                          orders <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">8</span>,</span>
<span>                          plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          confint.level <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p><img src="reference/figures/README-zeta-decays-1.png" width="100%"></p>
<blockquote>
<p>This plot shows how zeta diversity (a metric that captures shared species composition among multiple sites) changes with spatial distance across different orders of zeta (i.e., the number of sites considered at once).</p>
</blockquote>
<blockquote>
<ul>
<li>On the <strong>x-axis</strong>, we have the <strong>order of zeta</strong> (from 2 to 7).<br>
For example, zeta order 2 looks at pairs of sites, order 3 at triplets, etc.</li>
<li>On the <strong>y-axis</strong>, we see the slope of the <strong>relationship between zeta diversity and distance</strong> (i.e., how quickly species similarity declines with distance).</li>
<li>A <strong>negative slope</strong> means that <strong>sites farther apart have fewer species in common</strong> — so there’s a clear distance decay of biodiversity.</li>
<li>A <strong>slope near zero</strong> means <strong>distance doesn’t strongly affect how many species are shared among sites</strong>.</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Key observations:</strong> - At low orders (2 and 3), the slope is strongly negative, indicating that species turnover is high over distance when looking at pairs or triplets of sites. - From order 4 and up, the slope becomes close to zero, suggesting that at broader spatial scales (more sites), species similarity is less affected by distance.<br>
This may reflect widespread or core species that are consistently shared regardless of location. - The confidence intervals (error bars) shrink with increasing order, indicating greater stability and reliability of the estimate as more sites are included.</p>
</blockquote>
<blockquote>
<p><strong>Summary:</strong> This figure shows that biodiversity patterns across space are strongly shaped by distance at small scales, but this effect weakens as you include more sites. In other words, rare or localized species contribute to strong distance decay, but widespread species dominate at higher spatial scales, leading to more uniformity. <em>Species that occur in just two or three sites show a clear “farther apart → fewer shared species” pattern. But when you ask about the handful of really widespread species (those present in four, five, or more sites), their shared‐species counts no longer decline with distance—they form a spatially uniform core.</em></p>
</blockquote>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="id_13-run-a-multi-site-generalised-dissimilarity-model-for-order-2">13. Run a Multi-Site Generalised Dissimilarity Model for order 2<a class="anchor" aria-label="anchor" href="#id_13-run-a-multi-site-generalised-dissimilarity-model-for-order-2"></a>
</h3>
<div class="section level4">
<h4 id="multi-site-generalised-dissimilarity-modelling-for-a-set-of-environmental-variables-and-distances-using-zetadivzetamsgdm">Multi-site generalised dissimilarity modelling for a set of environmental variables and distances using <code>zetadiv::Zeta.msgdm</code>
<a class="anchor" aria-label="anchor" href="#multi-site-generalised-dissimilarity-modelling-for-a-set-of-environmental-variables-and-distances-using-zetadivzetamsgdm"></a>
</h4>
<p>Computes a regression model of zeta diversity for a given order (number of assemblages or sites) against a set of environmental variables and distances between sites. The different regression models available are generalised linear models, generalised linear models with negative constraints, generalised additive models, shape constrained additive models, and I-splines. <em>Generate statistics and figures, no maps and save fitted order 2 model ‘zeta2’</em></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute a regression model of zeta diversity order 2</span></span>
<span><span class="va">zeta2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zetadiv/man/Zeta.msgdm.html" class="external-link">Zeta.msgdm</a></span><span class="op">(</span><span class="va">site_spp_pa</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                   <span class="va">env_vars_reduced</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>,</span>
<span>                   <span class="co"># xy_utm_df[,3:4],</span></span>
<span>                   <span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                   sam <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                   order <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   distance.type <span class="op">=</span> <span class="st">"Euclidean"</span>,<span class="co"># "ortho",</span></span>
<span>                   normalize <span class="op">=</span> <span class="st">"Jaccard"</span>,</span>
<span>                   reg.type <span class="op">=</span> <span class="st">"ispline"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute splines coordinates from I-spline-based MSGDM</span></span>
<span><span class="va">zeta2.ispline</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zetadiv/man/Return.ispline.html" class="external-link">Return.ispline</a></span><span class="op">(</span><span class="va">zeta2</span>,</span>
<span>                               <span class="va">env_vars_reduced</span><span class="op">[</span>,<span class="op">-</span><span class="fl">8</span><span class="op">]</span>,</span>
<span>                               <span class="co"># legend = FALSE,</span></span>
<span>                               distance <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># zeta2.ispline</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/zetadiv/man/Plot.ispline.html" class="external-link">Plot.ispline</a></span><span class="op">(</span>isplines <span class="op">=</span> <span class="va">zeta2.ispline</span>, distance <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-zeta-msgdm-1.png" width="100%"></p>
<blockquote>
<p>This figure shows the fitted I-splines from a multi-site generalized dissimilarity model (via <code>Zeta.msgdm</code>), which represent the partial, monotonic relationship between each predictor and community turnover (ζ-diversity) over its 0–1 “rescaled” range. A few key take-aways:</p>
</blockquote>
<blockquote>
<ol style="list-style-type: decimal">
<li>
<strong>Distance (blue asterisks)</strong> has by far the largest I-spline amplitude—rising from ~0 at zero distance to ~0.05 at the maximum. That tells us spatial separation is the strongest driver of multi‐site turnover, and even small increases in distance yield a substantial drop in shared species.</li>
<li>
<strong>Sampling intensity (<code>obs_sum</code>, open circles)</strong> comes next, with a gentle but steady rise to ~0.045. This indicates that sites with more observations tend to share more species (or, conversely, that incomplete sampling can depress apparent turnover).</li>
<li>
<strong>Precipitation variables</strong>: <strong>Rain in the warm quarter (<code>rain_warmQ</code>, squares)</strong> and <strong>Rain in the dry quarter (<code>rain_dry</code>, triangles-down)</strong> both show moderate effects (I-spline heights ~0.02–0.03). This means differences in seasonal rainfall regimes contribute noticeably to changes in community composition.</li>
<li>
<strong>Temperature metrics</strong>: <strong>Mean temperature</strong> <em>(<code>temp_mean</code>, triangles-up)</em>, <strong>Wet‐quarter temperature</strong> <em>(<code>temp_wetQ</code>, X’s)</em>, <strong>Dry‐quarter temperature</strong> <em>(<code>temp_dryQ</code>, diamonds)</em>, and the <strong>isothermality index</strong> <em>(<code>iso</code>, plus signs)</em> all have very low, almost flat I-splines (max heights ≲0.01). In other words, these thermal variables explain very little additional turnover once you’ve accounted for distance and rainfall.</li>
</ol>
</blockquote>
<blockquote>
<p><strong>Ecological interpretation:</strong> Spatial distance is the dominant structuring factor in these data—sites further apart share markedly fewer species. After accounting for that, differences in observation effort and, to a lesser degree, seasonal rainfall still shape multisite community similarity. Temperature and seasonality metrics, by contrast, appear to have only a minor independent influence on zeta‐diversity in this landscape.</p>
</blockquote>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Deviance explained summary results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">zeta2</span><span class="op">$</span><span class="va">model</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">deviance</span><span class="op">/</span><span class="va">null.deviance</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 0.264315</span></span>
<span><span class="co"># [1] 0.2461561</span></span>
<span><span class="co"># 0.2461561 means that approximately 24.6% of the variability in the response</span></span>
<span><span class="co"># variable is explained by your model. This is relatively low, suggesting that the</span></span>
<span><span class="co"># model may not be capturing much of the underlying pattern in the data.</span></span>
<span></span>
<span><span class="co"># Model summary results</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">zeta2</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm.cons(formula = zeta.val ~ ., family = family, data = data.tot, </span></span>
<span><span class="co">#&gt;     control = control, method = "glm.fit.cons", cons = cons, </span></span>
<span><span class="co">#&gt;     cons.inter = cons.inter)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  0.103685   0.007458  13.903  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; obs_sum1    -0.047222   0.003601 -13.112  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; obs_sum2     0.000000   0.016421   0.000 1.000000    </span></span>
<span><span class="co">#&gt; obs_sum3     0.000000   0.021894   0.000 1.000000    </span></span>
<span><span class="co">#&gt; temp_mean1   0.000000   0.035343   0.000 1.000000    </span></span>
<span><span class="co">#&gt; temp_mean2  -0.009559   0.012775  -0.748 0.454502    </span></span>
<span><span class="co">#&gt; temp_mean3   0.000000   0.015940   0.000 1.000000    </span></span>
<span><span class="co">#&gt; iso1        -0.004022   0.013746  -0.293 0.769874    </span></span>
<span><span class="co">#&gt; iso2         0.000000   0.009277   0.000 1.000000    </span></span>
<span><span class="co">#&gt; iso3         0.000000   0.013286   0.000 1.000000    </span></span>
<span><span class="co">#&gt; temp_wetQ1   0.000000   0.011252   0.000 1.000000    </span></span>
<span><span class="co">#&gt; temp_wetQ2  -0.004848   0.009588  -0.506 0.613246    </span></span>
<span><span class="co">#&gt; temp_wetQ3  -0.003618   0.013219  -0.274 0.784346    </span></span>
<span><span class="co">#&gt; temp_dryQ1  -0.005572   0.033097  -0.168 0.866337    </span></span>
<span><span class="co">#&gt; temp_dryQ2  -0.006185   0.010479  -0.590 0.555161    </span></span>
<span><span class="co">#&gt; temp_dryQ3   0.000000   0.011843   0.000 1.000000    </span></span>
<span><span class="co">#&gt; rain_dry1   -0.018325   0.007454  -2.458 0.014127 *  </span></span>
<span><span class="co">#&gt; rain_dry2    0.000000   0.009306   0.000 1.000000    </span></span>
<span><span class="co">#&gt; rain_dry3    0.000000   0.014403   0.000 1.000000    </span></span>
<span><span class="co">#&gt; rain_warmQ1 -0.002312   0.008321  -0.278 0.781217    </span></span>
<span><span class="co">#&gt; rain_warmQ2 -0.015782   0.010613  -1.487 0.137324    </span></span>
<span><span class="co">#&gt; rain_warmQ3  0.000000   0.020082   0.000 1.000000    </span></span>
<span><span class="co">#&gt; distance1   -0.040602   0.011229  -3.616 0.000315 ***</span></span>
<span><span class="co">#&gt; distance2    0.000000   0.011820   0.000 1.000000    </span></span>
<span><span class="co">#&gt; distance3   -0.013797   0.015469  -0.892 0.372669    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 0.001674497)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 2.2192  on 999  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 1.6326  on 975  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: -3527.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="id_14-predict-current-zeta-diversity-zeta2-using-predict_dissim">14. Predict current Zeta Diversity (zeta2) using <code>predict_dissim</code>
<a class="anchor" aria-label="anchor" href="#id_14-predict-current-zeta-diversity-zeta2-using-predict_dissim"></a>
</h3>
<ul>
<li><em>In the ‘sbe’ add ‘sam.max’, a constant for all sites = max(sam.eff)</em></li>
<li><em>Predict for the updated sbe and xy</em></li>
<li><em>Produce a site by site matrix of predicted zeta ‘zeta.now’</em></li>
</ul>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predict current zeta diversity using `predict_dissim` with sampling effort, geographic distance and environmental variables</span></span>
<span><span class="co"># Only non-colinear environmental variables used in `zeta2` model</span></span>
<span><span class="va">predictors_df</span> <span class="op">=</span> <span class="fu"><a href="reference/predict_dissim.html">predict_dissim</a></span><span class="op">(</span></span>
<span>  block_sp   <span class="op">=</span> <span class="va">grid_spp</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  sbe        <span class="op">=</span> <span class="va">sbe</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>,<span class="co"># env_vars_reduced[,-8]</span></span>
<span>  zeta_model <span class="op">=</span> <span class="va">zeta2</span>,</span>
<span>  mean_rich  <span class="op">=</span> <span class="va">mean_rich_o1234</span>,</span>
<span>  mean_turn  <span class="op">=</span> <span class="va">mean_turn_o2345</span>,</span>
<span>  sbs_xy     <span class="op">=</span> <span class="va">xy</span>,</span>
<span>  x_col      <span class="op">=</span> <span class="st">"centroid_lon"</span>,</span>
<span>  y_col      <span class="op">=</span> <span class="st">"centroid_lat"</span>,</span>
<span>  rsa        <span class="op">=</span> <span class="va">rsa</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-predict-zeta2-1.png" width="100%"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">predictors_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 415  29</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">predictors_df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   obs_sum spp_rich temp_mean      mdr      iso temp_sea temp_max</span></span>
<span><span class="co">#&gt; 1       3        2  21.88425 14.47900 55.67347 427.1824   32.446</span></span>
<span><span class="co">#&gt; 2      41       31  21.76921 14.61358 53.90477 453.1160   32.977</span></span>
<span><span class="co">#&gt; 3      10       10  21.53492 14.00267 56.31250 392.8977   31.662</span></span>
<span><span class="co">#&gt; 4       7        7  23.01796 13.67825 57.83615 357.9102   32.791</span></span>
<span><span class="co">#&gt; 5       6        6  23.59879 13.83525 59.58590 334.4157   33.509</span></span>
<span><span class="co">#&gt; 6     107       76  24.57367 14.64933 61.67101 332.0319   34.788</span></span></code></pre></div>
<ul>
<li><em>Run nmds for the predicted zeta matrix</em></li>
<li><em>Plot RGB of the 3 component scores</em></li>
</ul>
<hr>
</div>
<div class="section level3">
<h3 id="id_15-run-clustering-analyses-using-map_bioreg">15. Run clustering analyses using <code>map_bioreg</code>
<a class="anchor" aria-label="anchor" href="#id_15-run-clustering-analyses-using-map_bioreg"></a>
</h3>
<ul>
<li><em>Map bioregion clusters of current zeta2</em></li>
<li><em>Generate maps of dissimilarity (the rgb plot)</em></li>
<li><em>Generate map of bioregions (from clustering)</em></li>
</ul>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run `map_bioreg` function to generate and plot clusters</span></span>
<span><span class="va">bioreg_result</span> <span class="op">=</span> <span class="fu"><a href="reference/map_bioreg.html">map_bioreg</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">predictors_df</span>,</span>
<span>  scale_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pred_zeta"</span>, <span class="st">"centroid_lon"</span>, <span class="st">"centroid_lat"</span><span class="op">)</span>,</span>
<span>  clus_method <span class="op">=</span> <span class="st">"all"</span>, <span class="co"># K-means, PAM, Hierarchical and GMM clustering</span></span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interp <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  x_col <span class="op">=</span><span class="st">'centroid_lon'</span>,</span>
<span>  y_col <span class="op">=</span><span class="st">'centroid_lat'</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; fitting ...</span></span>
<span><span class="co">#&gt;   |                                                                                                  |                                                                                          |   0%  |                                                                                                  |======                                                                                    |   7%  |                                                                                                  |============                                                                              |  13%  |                                                                                                  |==================                                                                        |  20%  |                                                                                                  |========================                                                                  |  27%  |                                                                                                  |==============================                                                            |  33%  |                                                                                                  |====================================                                                      |  40%  |                                                                                                  |==========================================                                                |  47%  |                                                                                                  |================================================                                          |  53%  |                                                                                                  |======================================================                                    |  60%  |                                                                                                  |============================================================                              |  67%  |                                                                                                  |==================================================================                        |  73%  |                                                                                                  |========================================================================                  |  80%  |                                                                                                  |==============================================================================            |  87%  |                                                                                                  |====================================================================================      |  93%  |                                                                                                  |==========================================================================================| 100%</span></span></code></pre></div>
<p><img src="reference/figures/README-zeta-cluster-1.png" width="100%"></p>
<hr>
</div>
<div class="section level3">
<h3 id="id_16-predict-future-zeta-diversity-and-map-bioregion-change-using-map_bioregdiff">16. Predict future Zeta Diversity and map bioregion change using <code>map_bioregDiff</code>
<a class="anchor" aria-label="anchor" href="#id_16-predict-future-zeta-diversity-and-map-bioregion-change-using-map_bioregdiff"></a>
</h3>
<ul>
<li><em>with appended (future scenarios) environmental variables and ‘sam.max’ in sbe</em></li>
<li><em>For m number of scenarios plus the present scenario (step 14) and n sites of xy</em></li>
<li><em>Updated sbe.future will have k = (m+1) x n number of rows</em></li>
<li><em>‘xy’ also updated with k rows</em></li>
<li><em>Predict a k by k matrix of predicted zeta ‘zeta.future’</em></li>
</ul>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOT RUN YET</span></span>
<span><span class="co"># future_df = predict_dissim(</span></span>
<span><span class="co">#   block_sp   = grid_spp[,-c(4:6)],</span></span>
<span><span class="co">#   sbe        = sbe[,-c(1:3)],</span></span>
<span><span class="co">#   zeta_model = zeta2,</span></span>
<span><span class="co">#   mean_rich  = mean_rich_o1234,</span></span>
<span><span class="co">#   mean_turn  = mean_turn_o2345,</span></span>
<span><span class="co">#   sbs_xy     = sbs_xy,</span></span>
<span><span class="co">#   x_col      = "centroid_lon",</span></span>
<span><span class="co">#   y_col      = "centroid_lat",</span></span>
<span><span class="co">#   rsa        = rsa</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="co"># Check results</span></span>
<span><span class="co"># dim(future_df)</span></span>
<span><span class="co"># head(future_df[,1:7])</span></span>
<span></span>
<span><span class="co"># Run `map_bioregDiff`</span></span>
<span><span class="co"># 'approach', specifies which metric to compute:</span></span>
<span><span class="co"># &gt;&gt; "difference_count": Counts cells with differing values across layers</span></span>
<span><span class="co"># &gt;&gt; "shannon_entropy": Calculates Shannon entropy, measuring diversity within layers</span></span>
<span><span class="co"># &gt;&gt; "stability": Identifies stable regions where values remain unchanged.</span></span>
<span><span class="co"># &gt;&gt; "transition_frequency": Quantifies the frequency of changes between layers</span></span>
<span><span class="co"># &gt;&gt; "weighted_change_index": Weighted score to changes based on a dissimilarity matrix</span></span>
<span><span class="co"># &gt;&gt; "all" (default): Returns all metrics as a combined SpatRaster</span></span>
<span></span>
<span><span class="va">result_bioregDiff</span> <span class="op">=</span> <span class="fu"><a href="reference/map_bioregDiff.html">map_bioregDiff</a></span><span class="op">(</span><span class="va">bioreg_result</span><span class="op">$</span><span class="va">clusters</span>, </span>
<span>                                   approach <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See results</span></span>
<span><span class="va">result_bioregDiff</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 25, 32, 5  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.5, 0.4999984  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 16.75, 32.75, -34.75, -22.25004  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       : Differ~_Count, Shanno~ntropy, Stability, Transi~quency, Weight~_Index </span></span>
<span><span class="co">#&gt; min values  :             0,      0.000000,         0,             0,       0.00000 </span></span>
<span><span class="co">#&gt; max values  :             3,      1.039721,         1,             3,       2.52819</span></span>
<span></span>
<span><span class="co"># Mask `result_bioregDiff` to the RSA boundary</span></span>
<span><span class="va">mask_bioregDiff</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span><span class="va">result_bioregDiff</span>, <span class="va">grid_masked</span>, method <span class="op">=</span> <span class="st">"near"</span><span class="op">)</span>, <span class="va">grid_masked</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot all change results</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mask_bioregDiff</span>, col <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-predict-future-1.png" width="100%"></p>
<ul>
<li><em>Nmds of zeta.future</em></li>
<li><em>Clustering of zeta.future</em></li>
<li><em>Map sub matrices to indicate predicted future dissimilarity</em></li>
<li><em>Map predicted future bioregions</em></li>
<li>
<em>Map temporal turnover</em> <em>Note: step 14 is redundant if step 16 is needed</em><br><em>Note: step 16 has the same code but more results including those from step 6 but potentially computational demanding</em>
</li>
</ul>
<hr>
</div>
<div class="section level3">
<h3 id="id_17-deposit-all-results-into-zenodo">17. Deposit all results into Zenodo<a class="anchor" aria-label="anchor" href="#id_17-deposit-all-results-into-zenodo"></a>
</h3>
<p>All data frames, tables, maps, and standard metadata can be deposited into Zenodo using <a href="https://github.com/eblondel/zen4R/wiki" class="external-link"><code>zen4R</code></a> or <a href="https://zenodo.org/records/10715460" class="external-link">Zenodo UI</a>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save(occ, sbs, sbe, zeta2, zeta_now, zeta_future, file="dissmapr_results.Rdata")</span></span>
<span><span class="co"># use zen4R or Zenodo UI to upload archive</span></span></code></pre></div>
<hr>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/macSands/dissmapr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/macSands/dissmapr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing dissmapr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Sandra MacFadyen <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://mybinder.org/v2/gh/nithecs-biomath/RBasicPack/master?urlpath=rstudio" class="external-link"><img src="https://mybinder.org/badge_logo.svg" alt="Binder"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://github.com/macSands/dissmapr/actions/workflows/test-coverage.yaml" class="external-link"><img src="https://github.com/macSands/dissmapr/actions/workflows/test-coverage.yaml/badge.svg" alt="test-coverage"></a></li>
<li><a href="https://app.codecov.io/gh/macSands/dissmapr" class="external-link"><img src="https://codecov.io/gh/macSands/dissmapr/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/macSands/dissmapr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/macSands/dissmapr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sandra MacFadyen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
